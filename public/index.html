<!doctype html><html lang=en dir=auto data-theme=auto><head><meta name=generator content="Hugo 0.152.2"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="noindex, nofollow"><title>Lei Wang</title><meta name=description content><meta name=author content><link rel=canonical href=http://localhost:1313/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://localhost:1313/index.xml title=rss><link rel=alternate type=application/json href=http://localhost:1313/index.json title=json><link rel=alternate hreflang=en href=http://localhost:1313/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Lei Wang (Alt + H)">Lei Wang</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives title=Archives><span>Archives</span></a></li><li><a href=http://localhost:1313/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://github.com/wlchn title=Github><span>Github</span>&nbsp;
<svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Hi there ğŸ‘‹</h1></header><div class=entry-content>I&rsquo;m Lei Wang, a full-stack developer.</div><footer class=entry-footer><div class=social-icons><a href=mailto:********************* target=_blank rel="noopener noreferrer me" title=Email><svg viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</a><a href=https://github.com/wlchn target=_blank rel="noopener noreferrer me" title=Github><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://x.com/wlchn target=_blank rel="noopener noreferrer me" title=X><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Hugo Post</h2></header><div class=entry-content><p>Introduction æŠŠç®€ä¹¦ä¸Šçš„åšå®¢æ¬åˆ° GitHub äº†ï¼Œç®€ä¹¦ä¸Šå¹¿å‘Šè¶Šæ¥è¶Šå¤šäº†ã€‚</p></div><footer class=entry-footer><span title='2023-04-23 00:00:00 +0800 CST'>April 23, 2023</span></footer><a class=entry-link aria-label="post link to Hugo Post" href=http://localhost:1313/posts/my-first-post/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Macè§£å†³too-many-open-filesé—®é¢˜</h2></header><div class=entry-content><p>æŸ¥çœ‹ maxfiles è®¾ç½®
launchctl limit è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„ maxfiles
sudo launchctl limit maxfiles 102400 102400 æŸ¥çœ‹åº”ç”¨èµ„æºæƒ…å†µ
lsof -n | awk '{print $1}' | uniq -c | sort -rn | head</p></div><footer class=entry-footer><span title='2022-08-10 00:00:00 +0800 CST'>August 10, 2022</span></footer><a class=entry-link aria-label="post link to Macè§£å†³too-many-open-filesé—®é¢˜" href=http://localhost:1313/posts/mac-too-many-open-files/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Kubernetes-watch-golangå®ç°</h2></header><div class=entry-content><p>ç¬¬ä¸€ç§æ–¹æ³• ä½¿ç”¨k8s.io/client-go/tools/cache
func StartWatchingServices(c *Client) { watchlist := cache.NewListWatchFromClient( c.K8sClientset.CoreV1().RESTClient(), string(v1.ResourceServices), v1.NamespaceAll, fields.Everything(), ) _, controller := cache.NewInformer( watchlist, &amp;v1.Service{}, 0, //Duration is int64 cache.ResourceEventHandlerFuncs{ AddFunc: func(obj interface{}) { fmt.Printf("added: %s \n", obj) }, DeleteFunc: func(obj interface{}) { fmt.Printf(deleted: %s \n", obj) }, UpdateFunc: func(oldObj, newObj interface{}) { fmt.Printf("changed \n") }, }, ) stop := make(chan struct{}) defer close(stop) go controller.Run(stop) for { time.Sleep(time.Second) } } ç¬¬äºŒç§æ–¹æ³• ä½¿ç”¨k8s.io/client-go/informersï¼Œå¯ä»¥ watch CRD èµ„æºä½†éœ€è¦ä½¿ç”¨ code-generator ç”Ÿæˆ clientset å’Œ informer(æŒ‡ CRD èµ„æº)ã€‚
...</p></div><footer class=entry-footer><span title='2020-06-23 00:00:00 +0800 CST'>June 23, 2020</span></footer><a class=entry-link aria-label="post link to Kubernetes-watch-golangå®ç°" href=http://localhost:1313/posts/kubernetes-watch-golang/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>åˆ©ç”¨Keycloakå®ç°Kuberneteså•ç‚¹ç™»å½•ä¸æƒé™éªŒè¯ï¼ˆSSO,OIDC,RBACï¼‰</h2></header><div class=entry-content><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ©ç”¨ Keycloak é…ç½® Kubernetes ç™»å½•éªŒè¯ï¼Œä»¥åŠ RBAC ç®¡ç†ã€‚ æœ¬æ–‡å…¨éƒ¨ä¸ºæµ‹è¯•ç¯å¢ƒå·¥å…·ã€‚ æµç¨‹ç¤ºæ„ é…ç½® Keycloak å®‰è£…é…ç½® ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ docker ç›´æ¥éƒ¨ç½² Keycloakã€‚å¦‚æœä½¿ç”¨ nginx éœ€è¦å°†PROXY_ADDRESS_FORWARDINGé…ç½®æˆtrue.
sudo docker run -e KEYCLOAK_USER=wanglei -e KEYCLOAK_PASSWORD=your_password -e PROXY_ADDRESS_FORWARDING=true -p 8081:8080 -d jboss/keycloak é…ç½® nginx å°† server_name é…ç½®æˆä½ çš„åŸŸå,ä»£ç† Keycloak ç«¯å£ï¼Œæ³¨æ„ä¸Šé¢PROXY_ADDRESS_FORWARDING=true
server { listen 80; server_name key.wanglei.me; location / { proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $http_host; proxy_pass http://localhost:8081; } } åœ¨ Clients ä¸­åˆ›å»º kubernetes è®¾ç½®Client IDä¸ºkubernetesï¼ŒClient Protocolé€‰æ‹©openid-connectå³ OIDC åè®®ã€‚ è®¾ç½® Client å°†Access Typeè®¾ç½®ä¸ºconfidential, Valid Redirect URIsæ ¹æ®éœ€è¦è®¾ç½®ï¼Œæœ¬æ–‡åé¢ç”¨åˆ° kubelogin,éœ€è¦è®¾ç½®ä¸ºhttp://localhost:8000 ...</p></div><footer class=entry-footer><span title='2020-02-28 00:00:00 +0800 CST'>February 28, 2020</span></footer><a class=entry-link aria-label="post link to åˆ©ç”¨Keycloakå®ç°Kuberneteså•ç‚¹ç™»å½•ä¸æƒé™éªŒè¯ï¼ˆSSO,OIDC,RBACï¼‰" href=http://localhost:1313/posts/keycloak-kubernetes-sso-oidc-rbac/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ä½¿ç”¨scratchæ„å»ºæœ€å°åŒ–Goç¨‹åºçš„docker-image</h2></header><div class=entry-content><p>ç”±äº Golang ç¼–è¯‘ä¹‹åçš„æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶ï¼Œè€Œ scratch æ˜¯ docker æœ€åŸºç¡€çš„ç©º imageï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ scratch æ¥æ„å»º Go ç¨‹åºçš„ docker imageï¼Œä½¿å¾—æœ€ç»ˆæ„å»ºçš„ image æœ€å°åŒ–.
æ„å»º image è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š
åœ¨ Go åŸºç¡€ image ä¸­ build. å°† build å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ° scratch image ä¸­ã€‚ æ— éœ€ cgo çš„ç¨‹åº å¯¹äºæ— éœ€ cgo äº¤å‰ç¼–è¯‘çš„ç¨‹åºï¼Œä½¿ç”¨ scratch æ¥ä½œä¸ºæœ€ç»ˆè¿è¡Œçš„åŸºç¡€ image éå¸¸åˆé€‚ã€‚
é¦–å…ˆï¼Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬çš„ golang åŸºç¡€ image æ¥ buildï¼Œè¿™é‡Œæ²¡æœ‰å¿…è¦é€‰æ‹©æ›´å°çš„ golang alpineï¼Œbuild è¿‡ç¨‹ä¸­ pull ä¸€èˆ¬ä¼šæœ‰ç¼“å­˜æ‰€ä»¥ pull é€Ÿåº¦å·®åˆ«ä¸å¤§ï¼Œæ­¤å¤– alpine ä¸­æ²¡æœ‰ git å’Œ sslï¼Œæˆ‘ä»¬åœ¨æ„å»º image è¿‡ç¨‹ä¸­éƒ½æœ‰å¯èƒ½ç”¨åˆ°ï¼Œå†µä¸” alpine ä¹Ÿä¸ä¼šå½±å“æœ€ç»ˆ image å¤§å°ã€‚
FROM golang:1.13 AS builder ç¦æ‰ cgo äº¤å‰ç¼–è¯‘ï¼Œæˆ‘ä»¬æœåŠ¡å™¨ä¸€èˆ¬ä¸º linux amd64ï¼Œbuild äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
...</p></div><footer class=entry-footer><span title='2019-11-22 00:00:00 +0800 CST'>November 22, 2019</span></footer><a class=entry-link aria-label="post link to ä½¿ç”¨scratchæ„å»ºæœ€å°åŒ–Goç¨‹åºçš„docker-image" href=http://localhost:1313/posts/scratch-go-docker-image/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ä¸åŒåŸŸåä¹‹é—´å…±äº«localStorage-sessionStorage</h2></header><div class=entry-content><p>é—®é¢˜ ä¸¤ä¸ªä¸åŒçš„åŸŸåçš„ localStorage ä¸èƒ½ç›´æ¥äº’ç›¸è®¿é—®ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨aaa.comä¸­å¦‚ä½•è°ƒç”¨bbb.comçš„ localStorage?
å®ç°åŸç† 1.åœ¨aaa.comçš„é¡µé¢ä¸­ï¼Œåœ¨é¡µé¢ä¸­åµŒå…¥ä¸€ä¸ª src ä¸ºbbb.comçš„iframeï¼Œæ­¤æ—¶è¿™ä¸ªiframeé‡Œå¯ä»¥è°ƒç”¨bbb.comçš„ localStorageã€‚ 2.ç”¨postMessageæ–¹æ³•å®ç°é¡µé¢ä¸iframeä¹‹é—´çš„é€šä¿¡ã€‚ ç»¼åˆ 1ã€2 ä¾¿å¯ä»¥å®ç°aaa.comä¸­è°ƒç”¨bbb.comçš„ localStorageã€‚
ä¼˜åŒ– iframe æˆ‘ä»¬å¯ä»¥åœ¨bbb.comä¸­å†™ä¸€ä¸ªä¸“é—¨è´Ÿè´£å…±äº« localStorage çš„é¡µé¢ï¼Œä¾‹å¦‚å«åšpage1.htmlï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ— ç”¨çš„èµ„æºåŠ è½½åˆ°iframeä¸­ã€‚
ç¤ºä¾‹ ä»¥åœ¨aaa.comä¸­è¯»å–bbb.comä¸­çš„ localStorage çš„item1ä¸ºä¾‹ï¼Œå†™åŒç†ï¼š bbb.comä¸­page1.htmlï¼Œç›‘å¬aaa.comé€šè¿‡postMessageä¼ æ¥çš„ä¿¡æ¯ï¼Œè¯»å– localStorageï¼Œç„¶åå†ä½¿ç”¨postMessageæ–¹æ³•ä¼ ç»™aaa.comçš„æ¥æ”¶è€…ã€‚
&lt;!DOCTYPE html> &lt;html lang="en-US"> &lt;head> &lt;script type="text/javascript"> window.addEventListener('message', function(event) { if (event.origin === 'https://aaa.com') { const { key } = event.data; const value = localStorage.getItem(key); event.source.postMessage({wallets: wallets}, event.origin); } }, false); &lt;/script> &lt;/head> &lt;body> This page is for sharing localstorage. &lt;/body> &lt;/html> åœ¨aaa.comçš„é¡µé¢ä¸­åŠ å…¥ä¸€ä¸ª src ä¸ºbbb.com/page1.htmléšè—çš„iframeã€‚
...</p></div><footer class=entry-footer><span title='2019-10-17 00:00:00 +0800 CST'>October 17, 2019</span></footer><a class=entry-link aria-label="post link to ä¸åŒåŸŸåä¹‹é—´å…±äº«localStorage-sessionStorage" href=http://localhost:1313/posts/share-localstorage-sessionstorage/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ä¸‰é—¨é—®é¢˜ï¼ˆè’™æéœå°”æ‚–è®ºï¼‰åˆ†æä¸Golangæ¨¡æ‹Ÿ</h2></header><div class=entry-content><p>é—®é¢˜æè¿° ä¸‰é—¨é—®é¢˜ï¼ˆMonty Hall problemï¼‰äº¦ç§°ä¸ºè’™æéœå°”é—®é¢˜ã€è’™ç‰¹éœé—®é¢˜æˆ–è’™æéœå°”æ‚–è®ºï¼Œå¤§è‡´å‡ºè‡ªç¾å›½çš„ç”µè§†æ¸¸æˆèŠ‚ç›® Letâ€™s Make a Dealã€‚é—®é¢˜åå­—æ¥è‡ªè¯¥èŠ‚ç›®çš„ä¸»æŒäººè’™æÂ·éœå°”ï¼ˆMonty Hallï¼‰ã€‚å‚èµ›è€…ä¼šçœ‹è§ä¸‰æ‰‡å…³é—­äº†çš„é—¨ï¼Œå…¶ä¸­ä¸€æ‰‡çš„åé¢æœ‰ä¸€è¾†æ±½è½¦ï¼Œé€‰ä¸­åé¢æœ‰è½¦çš„é‚£æ‰‡é—¨å¯èµ¢å¾—è¯¥æ±½è½¦ï¼Œå¦å¤–ä¸¤æ‰‡é—¨åé¢åˆ™å„è—æœ‰ä¸€åªå±±ç¾Šã€‚å½“å‚èµ›è€…é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä½†æœªå»å¼€å¯å®ƒçš„æ—¶å€™ï¼ŒèŠ‚ç›®ä¸»æŒäººå¼€å¯å‰©ä¸‹ä¸¤æ‰‡é—¨çš„å…¶ä¸­ä¸€æ‰‡ï¼Œéœ²å‡ºå…¶ä¸­ä¸€åªå±±ç¾Šã€‚ä¸»æŒäººå…¶åä¼šé—®å‚èµ›è€…è¦ä¸è¦æ¢å¦ä¸€æ‰‡ä»ç„¶å…³ä¸Šçš„é—¨ã€‚é—®é¢˜æ˜¯ï¼šæ¢å¦ä¸€æ‰‡é—¨ä¼šå¦å¢åŠ å‚èµ›è€…èµ¢å¾—æ±½è½¦çš„æœºç‡ï¼Ÿ
ç­”æ¡ˆ ç­”æ¡ˆæ˜¯ä¼šã€‚ä¸æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯ 1/3ã€‚æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯ 2/3ã€‚
äº‰è®® æœ‰äººè®¤ä¸ºï¼Œåœ¨ä¸»æŒäººæ’é™¤äº†ä¸€ä¸ªé—¨ä¹‹åï¼Œæ±½è½¦åªå¯èƒ½åœ¨å¦å¤–ä¸¤ä¸ªé—¨ä¸­ï¼Œæ‰€ä»¥åœ¨ä¸¤æ‰‡é—¨çš„æ¦‚ç‡å„æ˜¯ 1/2ã€‚
åˆ†æ é¦–å…ˆå‚èµ›è€…é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä¸»æŒäººæœªå¼€å¯é—¨æ—¶ï¼Œæ±½è½¦åœ¨è¿™æ‰‡é—¨çš„æ¦‚ç‡ä¸º 1/3ï¼Œåœ¨å¦å¤–ä¸¤æ‰‡é—¨ä¸­çš„æ¦‚ç‡ä¸º 2/3ï¼Œæ­¤æ—¶äº‰è®®ä¸å¤§ã€‚è€Œå¦å¤–ä¸¤æ‰‡é—¨ä¸­å¿…å®šè‡³å°‘æœ‰ä¸€æ‰‡æ˜¯å±±ç¾Šï¼Œæ‰€ä»¥å³ä½¿ä¸»æŒäººæŒ‡å‡ºè¿™ä¸¤æ‰‡é—¨ä¸­ä¸€æ‰‡æ˜¯å±±ç¾Šï¼Œå¹¶ä¸ä¼šå½±å“è¿™ä¸¤æ‰‡é—¨çš„æ¦‚ç‡ï¼Œä¸¤æ‰‡æ¦‚ç‡å’Œä»ä¸º 2/3ï¼Œæ­¤æ—¶ä¸€æ‰‡å·²çŸ¥æ˜¯å±±ç¾Šï¼Œæ‰€ä»¥ä¸¤æ‰‡ä¸­çš„å¦å¤–ä¸€æ‰‡æ˜¯æ±½è½¦çš„æ¦‚ç‡æ˜¯ 2/3ã€‚æ‰€ä»¥æ¢é—¨ä¼šæé«˜æ¦‚ç‡ã€‚
æ€è€ƒ å¦‚æœä¸»æŒäººå¼€å¯æ­éœ²ä¸€æ‰‡é—¨æ˜¯å±±ç¾Šåï¼Œå¦å¤–ä¸€ä¸ªäºº B æ­¤æ—¶åœ¨å‰©ä¸‹çš„ä¸¤æ‰‡é—¨ä¸­åšæŠ‰æ‹©ï¼Œå¹¶ä¸”ä»–ä¸çŸ¥é“å…¶ä»–ä¿¡æ¯ï¼ŒåªçŸ¥é“ä¸€æ‰‡æ˜¯æ±½è½¦ï¼Œä¸€æ‰‡æ˜¯ç¾Šï¼Œé‚£ä¹ˆæ­¤æ—¶ B é€‰æ‹©åˆ°æ±½è½¦çš„æ¦‚ç‡æ˜¯ 1/2ã€‚ è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä¹‹å‰çš„ä¿¡æ¯ï¼ŒB ä¸çŸ¥é“é‚£æ‰‡é—¨æ¦‚ç‡å¤§ï¼ŒB æ­¤æ—¶æ˜¯åœ¨ä¸¤æ‰‡é—¨ä¸­åšéšæœºé€‰æ‹©ï¼ŒB å¯èƒ½æœ‰ 1/2 çš„æ¦‚ç‡é€‰æ‹© A(å‚èµ›è€…)å¼€å§‹é€‰æ‹©çš„é—¨ï¼Œä¹Ÿæœ‰ 1/2 çš„æ¦‚ç‡é€‰æ‹© A å°†è¦æ¢çš„é—¨ã€‚æ‰€ä»¥ B é€‰æ‹©åˆ°æ±½è½¦çš„æ¦‚ç‡ä¸º 1/2 _ 1/3 + 1/2 _ 2/3 = 1/2ã€‚
ç¨‹åºæ¨¡æ‹Ÿ package main import ( "fmt" "math/rand" "time" ) func main() { totalTimes := 1000000 aRightTimes := 0 bRightTimes := 0 rand.Seed(time.Now().UnixNano()) for time := 1; time &lt;= totalTimes; time++ { doors := [3]bool{false, false, false} doors[rand.Intn(3)] = true aFirstChoice := rand.Intn(3) var hostChoice, aChangedChoice int for i, door := range doors { if i != aFirstChoice && !door { hostChoice = i } } for i, _ := range doors { if i != aFirstChoice && i != hostChoice { aChangedChoice = i } } var bChoice int if rand.Intn(2) == 0 { bChoice = aFirstChoice } else { bChoice = aChangedChoice } if doors[aChangedChoice] { aRightTimes++ } if doors[bChoice] { bRightTimes++ } } fmt.Println("totalTimes: ", totalTimes) fmt.Println("aChangedChoice: ", aRightTimes) fmt.Println("bChoice: ", bRightTimes) } ç»“æœç¬¦åˆé¢„æœŸï¼ŒA æ¢é—¨åæ­£ç¡®æ¦‚ç‡ä¸º 2/3ï¼ŒB éšæœºé€‰æ‹©æ­£ç¡®çš„æ¦‚ç‡ä¸º 1/2ï¼š
...</p></div><footer class=entry-footer><span title='2019-10-10 00:00:00 +0800 CST'>October 10, 2019</span></footer><a class=entry-link aria-label="post link to ä¸‰é—¨é—®é¢˜ï¼ˆè’™æéœå°”æ‚–è®ºï¼‰åˆ†æä¸Golangæ¨¡æ‹Ÿ" href=http://localhost:1313/posts/three-doors-golang/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Median-of-mediansæ— åºæ•°ç»„å¯»æ‰¾ä¸­ä½æ•°æœ€å·®O(n)å¤æ‚åº¦JSå®ç°</h2></header><div class=entry-content><p>åœ¨æ— åºæ•°ç»„ä¸­å¯»æ‰¾ä¸­ä½æ•°ï¼Œæœ€å·®å¤æ‚åº¦ä¸º O(n). å®ç°ç®—æ³•ä¸º Median of mediansï¼Œåˆå« BFPRT ç®—æ³•ã€‚ å®ç°åŸç†ä¸å¤æ‚åº¦ç ”ç©¶ï¼šhttps://en.wikipedia.org/wiki/Median_of_medians
è´´ä¸€ç‰ˆ JS å®ç°ï¼š
export const selectMedian = (arr, compare) => { return selectK(arr, Math.floor(arr.length / 2), compare); }; export const selectK = (arr, k, compare) => { if (!Array.isArray(arr) || arr.length === 0 || arr.length - 1 &lt; k) { return; } if (arr.length === 1) { return arr[0]; } let idx = selectIdx(arr, 0, arr.length - 1, k, compare || defaultCompare); return arr[idx]; }; const partition = (arr, left, right, pivot, compare) => { let temp = arr[pivot]; arr[pivot] = arr[right]; arr[right] = temp; let track = left; for (let i = left; i &lt; right; i++) { // if (arr[i] &lt; arr[right]) { if (compare(arr[i], arr[right]) === -1) { let t = arr[i]; arr[i] = arr[track]; arr[track] = t; track++; } } temp = arr[track]; arr[track] = arr[right]; arr[right] = temp; return track; }; const selectIdx = (arr, left, right, k, compare) => { if (left === right) { return left; } let dest = left + k; while (true) { let pivotIndex = right - left + 1 &lt;= 5 ? Math.floor(Math.random() * (right - left + 1)) + left : medianOfMedians(arr, left, right, compare); pivotIndex = partition(arr, left, right, pivotIndex, compare); if (pivotIndex === dest) { return pivotIndex; } else if (pivotIndex &lt; dest) { left = pivotIndex + 1; } else { right = pivotIndex - 1; } } }; const medianOfMedians = (arr, left, right, compare) => { let numMedians = Math.ceil((right - left) / 5); for (let i = 0; i &lt; numMedians; i++) { let subLeft = left + i * 5; let subRight = subLeft + 4; if (subRight > right) { subRight = right; } let medianIdx = selectIdx(arr, subLeft, subRight, Math.floor((subRight - subLeft) / 2), compare); let temp = arr[medianIdx]; arr[medianIdx] = arr[left + i]; arr[left + i] = temp; } return selectIdx(arr, left, left + numMedians - 1, Math.floor(numMedians / 2), compare); }; const defaultCompare = (a, b) => { return a &lt; b ? -1 : a > b ? 1 : 0; };</p></div><footer class=entry-footer><span title='2019-06-03 00:00:00 +0800 CST'>June 3, 2019</span></footer><a class=entry-link aria-label="post link to Median-of-mediansæ— åºæ•°ç»„å¯»æ‰¾ä¸­ä½æ•°æœ€å·®O(n)å¤æ‚åº¦JSå®ç°" href=http://localhost:1313/posts/median-of-medians-js/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ä¸ºReactå•é¡µåº”ç”¨æä¾›Runtimeè¿è¡Œæ—¶ç¯å¢ƒå˜é‡</h2></header><div class=entry-content><p>ä½¿ç”¨ create-react-app åˆ›å»ºçš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æ˜¯åœ¨ build æ—¶æ³¨å…¥ç¯å¢ƒå˜é‡çš„ã€‚ä¸€æ—¦ build æˆé™æ€æ–‡ä»¶ä¾¿ä¸èƒ½åŠ¨æ€æä¾›ç¯å¢ƒå˜é‡äº†ã€‚ æ¯”å¦‚ build ä¸€ä¸ªå•é¡µåº”ç”¨çš„ docker imageï¼Œå¯ä»¥åœ¨ build æ—¶æä¾›ç¯å¢ƒå˜é‡ã€‚ä½†æ˜¯å·²ç» build å®Œæˆï¼Œä½¿ç”¨ docker run è¿è¡Œçš„æ—¶å€™ä¸èƒ½å†ä¼ é€’ç¯å¢ƒå˜é‡ã€‚ æœ¬æ–‡ä¸»è¦è§£å†³åœ¨è¿è¡Œæ—¶æä¾›ç¯å¢ƒå˜é‡çš„é—®é¢˜ã€‚ åŸç†ï¼šé€šè¿‡ä¸€æ®µ shell è„šæœ¬å°†æŒ‡å®šå°† env è½¬æ¢ä¸º config.js æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å’Œ build å¥½çš„ static æ–‡ä»¶ serve åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œåœ¨åº”ç”¨ä¸­å¼•ç”¨ config.js æ–‡ä»¶ï¼Œé€šè¿‡ window._env è·å–ç¯å¢ƒå˜é‡ã€‚shell è„šæœ¬é€šè¿‡ docker image çš„ entrypoint æ‰§è¡Œã€‚æœåŠ¡ä½¿ç”¨ go æ„å»ºçš„ä¸€ä¸ªç®€å•æœåŠ¡å™¨ï¼Œæ¯” nginx è½»é‡å¾ˆå¤šã€‚
å°†å¦‚ä¸‹env.shæ–‡ä»¶æ‹·é—®åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œåœ¨ entrypointï¼ˆdocker runï¼‰æ—¶æ‰§è¡Œï¼Œä½œç”¨æ˜¯å°†ç¯å¢ƒå˜é‡è½¬å‡º config.js #!/bin/sh if [ $CONFIG_VARS ]; then # clear echo -n > ${CONFIG_FILE_PATH}/config.js SPLIT=$(echo $CONFIG_VARS | tr "," "\n") echo "window._env = {" >> ${CONFIG_FILE_PATH}/config.js for VAR in ${SPLIT}; do VALUE=$(printenv ${VAR}) echo " ${VAR}: \"${VALUE}\"," >> ${CONFIG_FILE_PATH}/config.js done echo "}" >> ${CONFIG_FILE_PATH}/config.js fi # disable broswer cache sed -i "s/config.js?v=[0-9]*/config.js?v=$(date +'%s')/g" /srv/http/index.html # for macOS # sed -i "" "s/config.js?v=[0-9]*/config.js?v=$(date +'%s')/g" /srv/http/index.html # exec CMD exec "$@" ä¾‹å¦‚
...</p></div><footer class=entry-footer><span title='2019-03-27 00:00:00 +0800 CST'>March 27, 2019</span></footer><a class=entry-link aria-label="post link to ä¸ºReactå•é¡µåº”ç”¨æä¾›Runtimeè¿è¡Œæ—¶ç¯å¢ƒå˜é‡" href=http://localhost:1313/posts/react-spa-runtime-docker-env/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Kubernetesç­‰å¾…éƒ¨ç½²å®Œæˆ-kubectl-wait-rollout</h2></header><div class=entry-content><p>ä½¿ç”¨ kubectl apply æˆ–è€… create å‘½ä»¤åˆ›å»º/æ›´æ–°éƒ¨ç½²åï¼Œå…¶ pod éœ€è¦æ—¶é—´å®Œæˆåˆ›å»º/æ›´æ–°ã€‚ å¦‚æœåœ¨ CI ä¸­ä¸ç­‰å¾…æ‰€æœ‰ pod æ›´æ–°å®Œæˆï¼Œä¸‹ä¸€æ­¥æµç¨‹å¾ˆæœ‰å¯èƒ½ä½¿ç”¨æ›´æ–°å‰çš„ç¯å¢ƒã€‚
æ­£ç¡®æ–¹æ³• kubectl rollout status æ ¹æ®å®é™…æƒ…å†µkubectl rollout statuså‘½ä»¤ï¼Œèƒ½å¤Ÿæ­£ç¡®çš„è·å– rollout statusã€‚
ATTEMPTS=0 ROLLOUT_STATUS_CMD="kubectl rollout status deployment/myapp -n namespace" until $ROLLOUT_STATUS_CMD || [ $ATTEMPTS -eq 60 ]; do $ROLLOUT_STATUS_CMD ATTEMPTS=$((attempts + 1)) sleep 10 done ä»¥ä¸Š shell è„šæœ¬ç»è¿‡è½®è¯¢kubectl rollout statuså¯ä»¥å¾ˆå¥½çš„è§£å†³å®é™…é—®é¢˜ã€‚
é”™è¯¯æ–¹æ³• kubectl wait æ³¨æ„kubectl waitå‘½ä»¤ä¸èƒ½é€‚ç”¨äºæ›´æ–°éƒ¨ç½²ã€‚
kubectl wait --for=condition=available --timeout=600s deployment/myapp -n namespace è¯¥å‘½ä»¤åªèƒ½åˆ¤æ–­ deployment æ˜¯å¦ availableï¼Œä¸èƒ½ç”¨æ¥åˆ¤æ–­ rolloutï¼Œå³ available çŠ¶æ€çš„ deploymentï¼Œå¾ˆå¯èƒ½è€çš„ pod è¿˜åœ¨ terminatingï¼Œæ–°çš„ pod è¿˜æ²¡åˆ›å»ºå¥½ã€‚
...</p></div><footer class=entry-footer><span title='2019-03-18 00:00:00 +0800 CST'>March 18, 2019</span></footer><a class=entry-link aria-label="post link to Kubernetesç­‰å¾…éƒ¨ç½²å®Œæˆ-kubectl-wait-rollout" href=http://localhost:1313/posts/kubernetes-kubectl-wait-rollout/></a></article><footer class=page-footer><nav class=pagination><a class=next href=http://localhost:1313/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Lei Wang</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>