<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.111.3"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Alan Wang</title><meta name=description content><meta name=author content><link rel=canonical href=http://wlchn.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><link rel=icon href=http://wlchn.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://wlchn.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://wlchn.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://wlchn.github.io/apple-touch-icon.png><link rel=mask-icon href=http://wlchn.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://wlchn.github.io/index.xml><link rel=alternate type=application/json href=http://wlchn.github.io/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Alan Wang"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="http://wlchn.github.io/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Alan Wang"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Alan Wang","url":"http://wlchn.github.io/","description":"","thumbnailUrl":"http://wlchn.github.io/favicon.ico","sameAs":["mailto:geekwanglei@gmail.com","https://linkedin.com/in/wlchn","https://github.com/wlchn","https://stackoverflow.com/users/5184758/alan-wang","https://twitter.com/wlchn"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://wlchn.github.io/ accesskey=h title="Alan Wang (Alt + H)">Alan Wang</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://github.com//wlchn title=Github><span>Github</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Hi there ğŸ‘‹</h1></header><div class=entry-content>Welcome to my page. I&rsquo;m Alan Wang, a full-stack developer.</div><footer class=entry-footer><div class=social-icons><a href=mailto:geekwanglei@gmail.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://linkedin.com/in/wlchn target=_blank rel="noopener noreferrer me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/wlchn target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://stackoverflow.com/users/5184758/alan-wang target=_blank rel="noopener noreferrer me" title=Stackoverflow><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.913 16.041v6.848h17.599v-6.848M7.16 18.696h8.925M7.65 13.937l8.675 1.8M9.214 9.124l8.058 3.758M12.086 4.65l6.849 5.66M15.774 1.111l5.313 7.162"/></svg></a><a href=https://twitter.com/wlchn target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2>Macè§£å†³too-many-open-filesé—®é¢˜</h2></header><div class=entry-content><p>æŸ¥çœ‹ maxfiles è®¾ç½®
launchctl limit è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„ maxfiles
sudo launchctl limit maxfiles 102400 102400 æŸ¥çœ‹åº”ç”¨èµ„æºæƒ…å†µ
lsof -n | awk '{print $1}' | uniq -c | sort -rn | head</p></div><footer class=entry-footer><span title='2022-08-10 00:00:00 +0800 CST'>August 10, 2022</span></footer><a class=entry-link aria-label="post link to Macè§£å†³too-many-open-filesé—®é¢˜" href=http://wlchn.github.io/posts/mac-too-many-open-files/></a></article><article class=post-entry><header class=entry-header><h2>Kubernetes-watch-golangå®ç°</h2></header><div class=entry-content><p>ç¬¬ä¸€ç§æ–¹æ³• ä½¿ç”¨k8s.io/client-go/tools/cache
func StartWatchingServices(c *Client) { watchlist := cache.NewListWatchFromClient( c.K8sClientset.CoreV1().RESTClient(), string(v1.ResourceServices), v1.NamespaceAll, fields.Everything(), ) _, controller := cache.NewInformer( watchlist, &amp;v1.Service{}, 0, //Duration is int64 cache.ResourceEventHandlerFuncs{ AddFunc: func(obj interface{}) { fmt.Printf("added: %s \n", obj) }, DeleteFunc: func(obj interface{}) { fmt.Printf(deleted: %s \n", obj) }, UpdateFunc: func(oldObj, newObj interface{}) { fmt.Printf("changed \n") }, }, ) stop := make(chan struct{}) defer close(stop) go controller.Run(stop) for { time.Sleep(time.Second) } } ç¬¬äºŒç§æ–¹æ³• ä½¿ç”¨k8s.io/client-go/informersï¼Œå¯ä»¥ watch CRD èµ„æºä½†éœ€è¦ä½¿ç”¨ code-generator ç”Ÿæˆ clientset å’Œ informer(æŒ‡ CRD èµ„æº)ã€‚...</p></div><footer class=entry-footer><span title='2020-06-23 00:00:00 +0800 CST'>June 23, 2020</span></footer><a class=entry-link aria-label="post link to Kubernetes-watch-golangå®ç°" href=http://wlchn.github.io/posts/kubernetes-watch-golang/></a></article><article class=post-entry><header class=entry-header><h2>åˆ©ç”¨Keycloakå®ç°Kuberneteså•ç‚¹ç™»å½•ä¸æƒé™éªŒè¯ï¼ˆSSO,OIDC,RBACï¼‰</h2></header><div class=entry-content><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ©ç”¨ Keycloak é…ç½® Kubernetes ç™»å½•éªŒè¯ï¼Œä»¥åŠ RBAC ç®¡ç†ã€‚ æœ¬æ–‡å…¨éƒ¨ä¸ºæµ‹è¯•ç¯å¢ƒå·¥å…·ã€‚ æµç¨‹ç¤ºæ„ é…ç½® Keycloak å®‰è£…é…ç½® ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ docker ç›´æ¥éƒ¨ç½² Keycloakã€‚å¦‚æœä½¿ç”¨ nginx éœ€è¦å°†PROXY_ADDRESS_FORWARDINGé…ç½®æˆtrue.
sudo docker run -e KEYCLOAK_USER=wanglei -e KEYCLOAK_PASSWORD=your_password -e PROXY_ADDRESS_FORWARDING=true -p 8081:8080 -d jboss/keycloak é…ç½® nginx å°† server_name é…ç½®æˆä½ çš„åŸŸå,ä»£ç† Keycloak ç«¯å£ï¼Œæ³¨æ„ä¸Šé¢PROXY_ADDRESS_FORWARDING=true
server { listen 80; server_name key.wanglei.me; location / { proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host $http_host; proxy_pass http://localhost:8081; } } åœ¨ Clients ä¸­åˆ›å»º kubernetes è®¾ç½®Client IDä¸ºkubernetesï¼ŒClient Protocolé€‰æ‹©openid-connectå³ OIDC åè®®ã€‚ è®¾ç½® Client å°†Access Typeè®¾ç½®ä¸ºconfidential, Valid Redirect URIsæ ¹æ®éœ€è¦è®¾ç½®ï¼Œæœ¬æ–‡åé¢ç”¨åˆ° kubelogin,éœ€è¦è®¾ç½®ä¸ºhttp://localhost:8000 è®°å½• Client Secret åœ¨ Credentials ä¸­æ‰¾åˆ° Secretï¼Œåé¢éœ€è¦ç”¨åˆ°ã€‚ æ–°å»º Mapper é€‰æ‹©Mapper Typeä¸ºUser Attribute,é€‰æ‹©Claim JSON Typeä¸ºString,ä¸‹é¢å¼€å…³ä¸€å¾‹é€‰on(å¯æ ¹æ®éœ€æ±‚æ›´æ”¹)ã€‚æ­¤å¤„Token Claim Nameå­—æ®µè®¾ç½®ä¸ºgroups,åé¢é…ç½® kube-apiserver ä¼šç”¨åˆ°ã€‚ ä¸º User æ·»åŠ  Attribute æ·»åŠ  key groups, value admin,ç„¶åç‚¹å‡» addï¼Œå† saveã€‚ é…ç½® kubernetes æ­¤å¤„ä½¿ç”¨ kind(kubernetes in docker) https://github....</p></div><footer class=entry-footer><span title='2020-02-28 00:00:00 +0800 CST'>February 28, 2020</span></footer><a class=entry-link aria-label="post link to åˆ©ç”¨Keycloakå®ç°Kuberneteså•ç‚¹ç™»å½•ä¸æƒé™éªŒè¯ï¼ˆSSO,OIDC,RBACï¼‰" href=http://wlchn.github.io/posts/keycloak-kubernetes-sso-oidc-rbac/></a></article><article class=post-entry><header class=entry-header><h2>ä½¿ç”¨scratchæ„å»ºæœ€å°åŒ–Goç¨‹åºçš„docker-image</h2></header><div class=entry-content><p>ç”±äº Golang ç¼–è¯‘ä¹‹åçš„æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶ï¼Œè€Œ scratch æ˜¯ docker æœ€åŸºç¡€çš„ç©º imageï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ scratch æ¥æ„å»º Go ç¨‹åºçš„ docker imageï¼Œä½¿å¾—æœ€ç»ˆæ„å»ºçš„ image æœ€å°åŒ–.
æ„å»º image è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š
åœ¨ Go åŸºç¡€ image ä¸­ build. å°† build å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ° scratch image ä¸­ã€‚ æ— éœ€ cgo çš„ç¨‹åº å¯¹äºæ— éœ€ cgo äº¤å‰ç¼–è¯‘çš„ç¨‹åºï¼Œä½¿ç”¨ scratch æ¥ä½œä¸ºæœ€ç»ˆè¿è¡Œçš„åŸºç¡€ image éå¸¸åˆé€‚ã€‚
é¦–å…ˆï¼Œé€‰æ‹©åˆé€‚ç‰ˆæœ¬çš„ golang åŸºç¡€ image æ¥ buildï¼Œè¿™é‡Œæ²¡æœ‰å¿…è¦é€‰æ‹©æ›´å°çš„ golang alpineï¼Œbuild è¿‡ç¨‹ä¸­ pull ä¸€èˆ¬ä¼šæœ‰ç¼“å­˜æ‰€ä»¥ pull é€Ÿåº¦å·®åˆ«ä¸å¤§ï¼Œæ­¤å¤– alpine ä¸­æ²¡æœ‰ git å’Œ sslï¼Œæˆ‘ä»¬åœ¨æ„å»º image è¿‡ç¨‹ä¸­éƒ½æœ‰å¯èƒ½ç”¨åˆ°ï¼Œå†µä¸” alpine ä¹Ÿä¸ä¼šå½±å“æœ€ç»ˆ image å¤§å°ã€‚
FROM golang:1.13 AS builder ç¦æ‰ cgo äº¤å‰ç¼–è¯‘ï¼Œæˆ‘ä»¬æœåŠ¡å™¨ä¸€èˆ¬ä¸º linux amd64ï¼Œbuild äºŒè¿›åˆ¶æ–‡ä»¶ã€‚...</p></div><footer class=entry-footer><span title='2019-11-22 00:00:00 +0800 CST'>November 22, 2019</span></footer><a class=entry-link aria-label="post link to ä½¿ç”¨scratchæ„å»ºæœ€å°åŒ–Goç¨‹åºçš„docker-image" href=http://wlchn.github.io/posts/scratch-go-docker-image/></a></article><article class=post-entry><header class=entry-header><h2>ä¸åŒåŸŸåä¹‹é—´å…±äº«localStorage-sessionStorage</h2></header><div class=entry-content><p>é—®é¢˜ ä¸¤ä¸ªä¸åŒçš„åŸŸåçš„ localStorage ä¸èƒ½ç›´æ¥äº’ç›¸è®¿é—®ã€‚é‚£ä¹ˆå¦‚ä½•åœ¨aaa.comä¸­å¦‚ä½•è°ƒç”¨bbb.comçš„ localStorage?
å®ç°åŸç† 1.åœ¨aaa.comçš„é¡µé¢ä¸­ï¼Œåœ¨é¡µé¢ä¸­åµŒå…¥ä¸€ä¸ª src ä¸ºbbb.comçš„iframeï¼Œæ­¤æ—¶è¿™ä¸ªiframeé‡Œå¯ä»¥è°ƒç”¨bbb.comçš„ localStorageã€‚ 2.ç”¨postMessageæ–¹æ³•å®ç°é¡µé¢ä¸iframeä¹‹é—´çš„é€šä¿¡ã€‚ ç»¼åˆ 1ã€2 ä¾¿å¯ä»¥å®ç°aaa.comä¸­è°ƒç”¨bbb.comçš„ localStorageã€‚
ä¼˜åŒ– iframe æˆ‘ä»¬å¯ä»¥åœ¨bbb.comä¸­å†™ä¸€ä¸ªä¸“é—¨è´Ÿè´£å…±äº« localStorage çš„é¡µé¢ï¼Œä¾‹å¦‚å«åšpage1.htmlï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æ— ç”¨çš„èµ„æºåŠ è½½åˆ°iframeä¸­ã€‚
ç¤ºä¾‹ ä»¥åœ¨aaa.comä¸­è¯»å–bbb.comä¸­çš„ localStorage çš„item1ä¸ºä¾‹ï¼Œå†™åŒç†ï¼š bbb.comä¸­page1.htmlï¼Œç›‘å¬aaa.comé€šè¿‡postMessageä¼ æ¥çš„ä¿¡æ¯ï¼Œè¯»å– localStorageï¼Œç„¶åå†ä½¿ç”¨postMessageæ–¹æ³•ä¼ ç»™aaa.comçš„æ¥æ”¶è€…ã€‚
&lt;!DOCTYPE html> &lt;html lang="en-US"> &lt;head> &lt;script type="text/javascript"> window.addEventListener('message', function(event) { if (event.origin === 'https://aaa.com') { const { key } = event.data; const value = localStorage.getItem(key); event.source.postMessage({wallets: wallets}, event.origin); } }, false); &lt;/script> &lt;/head> &lt;body> This page is for sharing localstorage. &lt;/body> &lt;/html> åœ¨aaa.comçš„é¡µé¢ä¸­åŠ å…¥ä¸€ä¸ª src ä¸ºbbb....</p></div><footer class=entry-footer><span title='2019-10-17 00:00:00 +0800 CST'>October 17, 2019</span></footer><a class=entry-link aria-label="post link to ä¸åŒåŸŸåä¹‹é—´å…±äº«localStorage-sessionStorage" href=http://wlchn.github.io/posts/share-localstorage-sessionstorage/></a></article><article class=post-entry><header class=entry-header><h2>ä¸‰é—¨é—®é¢˜ï¼ˆè’™æéœå°”æ‚–è®ºï¼‰åˆ†æä¸Golangæ¨¡æ‹Ÿ</h2></header><div class=entry-content><p>é—®é¢˜æè¿° ä¸‰é—¨é—®é¢˜ï¼ˆMonty Hall problemï¼‰äº¦ç§°ä¸ºè’™æéœå°”é—®é¢˜ã€è’™ç‰¹éœé—®é¢˜æˆ–è’™æéœå°”æ‚–è®ºï¼Œå¤§è‡´å‡ºè‡ªç¾å›½çš„ç”µè§†æ¸¸æˆèŠ‚ç›® Letâ€™s Make a Dealã€‚é—®é¢˜åå­—æ¥è‡ªè¯¥èŠ‚ç›®çš„ä¸»æŒäººè’™æÂ·éœå°”ï¼ˆMonty Hallï¼‰ã€‚å‚èµ›è€…ä¼šçœ‹è§ä¸‰æ‰‡å…³é—­äº†çš„é—¨ï¼Œå…¶ä¸­ä¸€æ‰‡çš„åé¢æœ‰ä¸€è¾†æ±½è½¦ï¼Œé€‰ä¸­åé¢æœ‰è½¦çš„é‚£æ‰‡é—¨å¯èµ¢å¾—è¯¥æ±½è½¦ï¼Œå¦å¤–ä¸¤æ‰‡é—¨åé¢åˆ™å„è—æœ‰ä¸€åªå±±ç¾Šã€‚å½“å‚èµ›è€…é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä½†æœªå»å¼€å¯å®ƒçš„æ—¶å€™ï¼ŒèŠ‚ç›®ä¸»æŒäººå¼€å¯å‰©ä¸‹ä¸¤æ‰‡é—¨çš„å…¶ä¸­ä¸€æ‰‡ï¼Œéœ²å‡ºå…¶ä¸­ä¸€åªå±±ç¾Šã€‚ä¸»æŒäººå…¶åä¼šé—®å‚èµ›è€…è¦ä¸è¦æ¢å¦ä¸€æ‰‡ä»ç„¶å…³ä¸Šçš„é—¨ã€‚é—®é¢˜æ˜¯ï¼šæ¢å¦ä¸€æ‰‡é—¨ä¼šå¦å¢åŠ å‚èµ›è€…èµ¢å¾—æ±½è½¦çš„æœºç‡ï¼Ÿ
ç­”æ¡ˆ ç­”æ¡ˆæ˜¯ä¼šã€‚ä¸æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯ 1/3ã€‚æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯ 2/3ã€‚
äº‰è®® æœ‰äººè®¤ä¸ºï¼Œåœ¨ä¸»æŒäººæ’é™¤äº†ä¸€ä¸ªé—¨ä¹‹åï¼Œæ±½è½¦åªå¯èƒ½åœ¨å¦å¤–ä¸¤ä¸ªé—¨ä¸­ï¼Œæ‰€ä»¥åœ¨ä¸¤æ‰‡é—¨çš„æ¦‚ç‡å„æ˜¯ 1/2ã€‚
åˆ†æ é¦–å…ˆå‚èµ›è€…é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä¸»æŒäººæœªå¼€å¯é—¨æ—¶ï¼Œæ±½è½¦åœ¨è¿™æ‰‡é—¨çš„æ¦‚ç‡ä¸º 1/3ï¼Œåœ¨å¦å¤–ä¸¤æ‰‡é—¨ä¸­çš„æ¦‚ç‡ä¸º 2/3ï¼Œæ­¤æ—¶äº‰è®®ä¸å¤§ã€‚è€Œå¦å¤–ä¸¤æ‰‡é—¨ä¸­å¿…å®šè‡³å°‘æœ‰ä¸€æ‰‡æ˜¯å±±ç¾Šï¼Œæ‰€ä»¥å³ä½¿ä¸»æŒäººæŒ‡å‡ºè¿™ä¸¤æ‰‡é—¨ä¸­ä¸€æ‰‡æ˜¯å±±ç¾Šï¼Œå¹¶ä¸ä¼šå½±å“è¿™ä¸¤æ‰‡é—¨çš„æ¦‚ç‡ï¼Œä¸¤æ‰‡æ¦‚ç‡å’Œä»ä¸º 2/3ï¼Œæ­¤æ—¶ä¸€æ‰‡å·²çŸ¥æ˜¯å±±ç¾Šï¼Œæ‰€ä»¥ä¸¤æ‰‡ä¸­çš„å¦å¤–ä¸€æ‰‡æ˜¯æ±½è½¦çš„æ¦‚ç‡æ˜¯ 2/3ã€‚æ‰€ä»¥æ¢é—¨ä¼šæé«˜æ¦‚ç‡ã€‚
æ€è€ƒ å¦‚æœä¸»æŒäººå¼€å¯æ­éœ²ä¸€æ‰‡é—¨æ˜¯å±±ç¾Šåï¼Œå¦å¤–ä¸€ä¸ªäºº B æ­¤æ—¶åœ¨å‰©ä¸‹çš„ä¸¤æ‰‡é—¨ä¸­åšæŠ‰æ‹©ï¼Œå¹¶ä¸”ä»–ä¸çŸ¥é“å…¶ä»–ä¿¡æ¯ï¼ŒåªçŸ¥é“ä¸€æ‰‡æ˜¯æ±½è½¦ï¼Œä¸€æ‰‡æ˜¯ç¾Šï¼Œé‚£ä¹ˆæ­¤æ—¶ B é€‰æ‹©åˆ°æ±½è½¦çš„æ¦‚ç‡æ˜¯ 1/2ã€‚ è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä¹‹å‰çš„ä¿¡æ¯ï¼ŒB ä¸çŸ¥é“é‚£æ‰‡é—¨æ¦‚ç‡å¤§ï¼ŒB æ­¤æ—¶æ˜¯åœ¨ä¸¤æ‰‡é—¨ä¸­åšéšæœºé€‰æ‹©ï¼ŒB å¯èƒ½æœ‰ 1/2 çš„æ¦‚ç‡é€‰æ‹© A(å‚èµ›è€…)å¼€å§‹é€‰æ‹©çš„é—¨ï¼Œä¹Ÿæœ‰ 1/2 çš„æ¦‚ç‡é€‰æ‹© A å°†è¦æ¢çš„é—¨ã€‚æ‰€ä»¥ B é€‰æ‹©åˆ°æ±½è½¦çš„æ¦‚ç‡ä¸º 1/2 _ 1/3 + 1/2 _ 2/3 = 1/2ã€‚
ç¨‹åºæ¨¡æ‹Ÿ package main import ( "fmt" "math/rand" "time" ) func main() { totalTimes := 1000000 aRightTimes := 0 bRightTimes := 0 rand....</p></div><footer class=entry-footer><span title='2019-10-10 00:00:00 +0800 CST'>October 10, 2019</span></footer><a class=entry-link aria-label="post link to ä¸‰é—¨é—®é¢˜ï¼ˆè’™æéœå°”æ‚–è®ºï¼‰åˆ†æä¸Golangæ¨¡æ‹Ÿ" href=http://wlchn.github.io/posts/three-doors-golang/></a></article><article class=post-entry><header class=entry-header><h2>Median-of-mediansæ— åºæ•°ç»„å¯»æ‰¾ä¸­ä½æ•°æœ€å·®O(n)å¤æ‚åº¦JSå®ç°</h2></header><div class=entry-content><p>åœ¨æ— åºæ•°ç»„ä¸­å¯»æ‰¾ä¸­ä½æ•°ï¼Œæœ€å·®å¤æ‚åº¦ä¸º O(n). å®ç°ç®—æ³•ä¸º Median of mediansï¼Œåˆå« BFPRT ç®—æ³•ã€‚ å®ç°åŸç†ä¸å¤æ‚åº¦ç ”ç©¶ï¼šhttps://en.wikipedia.org/wiki/Median_of_medians
è´´ä¸€ç‰ˆ JS å®ç°ï¼š
export const selectMedian = (arr, compare) => { return selectK(arr, Math.floor(arr.length / 2), compare); }; export const selectK = (arr, k, compare) => { if (!Array.isArray(arr) || arr.length === 0 || arr.length - 1 &lt; k) { return; } if (arr.length === 1) { return arr[0]; } let idx = selectIdx(arr, 0, arr.length - 1, k, compare || defaultCompare); return arr[idx]; }; const partition = (arr, left, right, pivot, compare) => { let temp = arr[pivot]; arr[pivot] = arr[right]; arr[right] = temp; let track = left; for (let i = left; i &lt; right; i++) { // if (arr[i] &lt; arr[right]) { if (compare(arr[i], arr[right]) === -1) { let t = arr[i]; arr[i] = arr[track]; arr[track] = t; track++; } } temp = arr[track]; arr[track] = arr[right]; arr[right] = temp; return track; }; const selectIdx = (arr, left, right, k, compare) => { if (left === right) { return left; } let dest = left + k; while (true) { let pivotIndex = right - left + 1 &lt;= 5 ?...</p></div><footer class=entry-footer><span title='2019-06-03 00:00:00 +0800 CST'>June 3, 2019</span></footer><a class=entry-link aria-label="post link to Median-of-mediansæ— åºæ•°ç»„å¯»æ‰¾ä¸­ä½æ•°æœ€å·®O(n)å¤æ‚åº¦JSå®ç°" href=http://wlchn.github.io/posts/median-of-medians-js/></a></article><article class=post-entry><header class=entry-header><h2>ä¸ºReactå•é¡µåº”ç”¨æä¾›Runtimeè¿è¡Œæ—¶ç¯å¢ƒå˜é‡</h2></header><div class=entry-content><p>ä½¿ç”¨ create-react-app åˆ›å»ºçš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰æ˜¯åœ¨ build æ—¶æ³¨å…¥ç¯å¢ƒå˜é‡çš„ã€‚ä¸€æ—¦ build æˆé™æ€æ–‡ä»¶ä¾¿ä¸èƒ½åŠ¨æ€æä¾›ç¯å¢ƒå˜é‡äº†ã€‚ æ¯”å¦‚ build ä¸€ä¸ªå•é¡µåº”ç”¨çš„ docker imageï¼Œå¯ä»¥åœ¨ build æ—¶æä¾›ç¯å¢ƒå˜é‡ã€‚ä½†æ˜¯å·²ç» build å®Œæˆï¼Œä½¿ç”¨ docker run è¿è¡Œçš„æ—¶å€™ä¸èƒ½å†ä¼ é€’ç¯å¢ƒå˜é‡ã€‚ æœ¬æ–‡ä¸»è¦è§£å†³åœ¨è¿è¡Œæ—¶æä¾›ç¯å¢ƒå˜é‡çš„é—®é¢˜ã€‚ åŸç†ï¼šé€šè¿‡ä¸€æ®µ shell è„šæœ¬å°†æŒ‡å®šå°† env è½¬æ¢ä¸º config.js æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å’Œ build å¥½çš„ static æ–‡ä»¶ serve åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œåœ¨åº”ç”¨ä¸­å¼•ç”¨ config.js æ–‡ä»¶ï¼Œé€šè¿‡ window._env è·å–ç¯å¢ƒå˜é‡ã€‚shell è„šæœ¬é€šè¿‡ docker image çš„ entrypoint æ‰§è¡Œã€‚æœåŠ¡ä½¿ç”¨ go æ„å»ºçš„ä¸€ä¸ªç®€å•æœåŠ¡å™¨ï¼Œæ¯” nginx è½»é‡å¾ˆå¤šã€‚
å°†å¦‚ä¸‹env.shæ–‡ä»¶æ‹·é—®åˆ°é¡¹ç›®ç›®å½•ä¸‹ï¼Œåœ¨ entrypointï¼ˆdocker runï¼‰æ—¶æ‰§è¡Œï¼Œä½œç”¨æ˜¯å°†ç¯å¢ƒå˜é‡è½¬å‡º config.js #!/bin/sh if [ $CONFIG_VARS ]; then # clear echo -n > ${CONFIG_FILE_PATH}/config.js SPLIT=$(echo $CONFIG_VARS | tr "," "\n") echo "window....</p></div><footer class=entry-footer><span title='2019-03-27 00:00:00 +0800 CST'>March 27, 2019</span></footer><a class=entry-link aria-label="post link to ä¸ºReactå•é¡µåº”ç”¨æä¾›Runtimeè¿è¡Œæ—¶ç¯å¢ƒå˜é‡" href=http://wlchn.github.io/posts/react-spa-runtime-docker-env/></a></article><article class=post-entry><header class=entry-header><h2>Kubernetesç­‰å¾…éƒ¨ç½²å®Œæˆ-kubectl-wait-rollout</h2></header><div class=entry-content><p>ä½¿ç”¨ kubectl apply æˆ–è€… create å‘½ä»¤åˆ›å»º/æ›´æ–°éƒ¨ç½²åï¼Œå…¶ pod éœ€è¦æ—¶é—´å®Œæˆåˆ›å»º/æ›´æ–°ã€‚ å¦‚æœåœ¨ CI ä¸­ä¸ç­‰å¾…æ‰€æœ‰ pod æ›´æ–°å®Œæˆï¼Œä¸‹ä¸€æ­¥æµç¨‹å¾ˆæœ‰å¯èƒ½ä½¿ç”¨æ›´æ–°å‰çš„ç¯å¢ƒã€‚
æ­£ç¡®æ–¹æ³• kubectl rollout status æ ¹æ®å®é™…æƒ…å†µkubectl rollout statuså‘½ä»¤ï¼Œèƒ½å¤Ÿæ­£ç¡®çš„è·å– rollout statusã€‚
ATTEMPTS=0 ROLLOUT_STATUS_CMD="kubectl rollout status deployment/myapp -n namespace" until $ROLLOUT_STATUS_CMD || [ $ATTEMPTS -eq 60 ]; do $ROLLOUT_STATUS_CMD ATTEMPTS=$((attempts + 1)) sleep 10 done ä»¥ä¸Š shell è„šæœ¬ç»è¿‡è½®è¯¢kubectl rollout statuså¯ä»¥å¾ˆå¥½çš„è§£å†³å®é™…é—®é¢˜ã€‚
é”™è¯¯æ–¹æ³• kubectl wait æ³¨æ„kubectl waitå‘½ä»¤ä¸èƒ½é€‚ç”¨äºæ›´æ–°éƒ¨ç½²ã€‚
kubectl wait --for=condition=available --timeout=600s deployment/myapp -n namespace è¯¥å‘½ä»¤åªèƒ½åˆ¤æ–­ deployment æ˜¯å¦ availableï¼Œä¸èƒ½ç”¨æ¥åˆ¤æ–­ rolloutï¼Œå³ available çŠ¶æ€çš„ deploymentï¼Œå¾ˆå¯èƒ½è€çš„ pod è¿˜åœ¨ terminatingï¼Œæ–°çš„ pod è¿˜æ²¡åˆ›å»ºå¥½ã€‚...</p></div><footer class=entry-footer><span title='2019-03-18 00:00:00 +0800 CST'>March 18, 2019</span></footer><a class=entry-link aria-label="post link to Kubernetesç­‰å¾…éƒ¨ç½²å®Œæˆ-kubectl-wait-rollout" href=http://wlchn.github.io/posts/kubernetes-kubectl-wait-rollout/></a></article><article class=post-entry><header class=entry-header><h2>Go-WebAssembly-å…¥é—¨ï¼ˆäºŒï¼‰</h2></header><div class=entry-content><p>ç³»åˆ—æ–‡ç«  Go WebAssembly å…¥é—¨ï¼ˆä¸€ï¼‰
Getting Started ç¼–å†™ main.go
package main import ( "strconv" "syscall/js" ) // ä¼ å…¥value1, value2, resultä¸‰ä¸ªå…ƒç´ çš„idï¼Œå°†value1+value2ç»“æœèµ‹ç»™resultå…ƒç´  func add(ids []js.Value) { // æ ¹æ®idè·å–è¾“å…¥å€¼ value1 := js.Global().Get("document").Call("getElementById", ids[0].String()).Get("value").String() value2 := js.Global().Get("document").Call("getElementById", ids[1].String()).Get("value").String() int1, _ := strconv.Atoi(value1) int2, _ := strconv.Atoi(value2) // å°†ç›¸åŠ ç»“æœsetç»™resultå…ƒç´  js.Global().Get("document").Call("getElementById", ids[2].String()).Set("value", int1+int2) } // æ·»åŠ ç›‘å¬äº‹ä»¶ func registerCallbacks() { js.Global().Set("add", js.NewCallback(add)) } func main() { c := make(chan struct{}, 0) println("Go WebAssembly Initialized!") registerCallbacks() &lt;-c } å°† main....</p></div><footer class=entry-footer><span title='2019-02-02 01:00:00 +0800 CST'>February 2, 2019</span></footer><a class=entry-link aria-label="post link to Go-WebAssembly-å…¥é—¨ï¼ˆäºŒï¼‰" href=http://wlchn.github.io/posts/go-webassembly-tutorial-2/></a></article><footer class=page-footer><nav class=pagination><a class=next href=http://wlchn.github.io/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=http://wlchn.github.io/>Alan Wang</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>